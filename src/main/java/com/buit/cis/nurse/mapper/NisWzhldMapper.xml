<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 危重患者护理单 -->
<mapper namespace="com.buit.cis.nurse.dao.NisWzhldDao">

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
        JLXH as jlxh,ZYH as zyh,MBLX as mblx,YS as ys,TW as tw,MB as mb,HX as hx,SBP as sbp,DBP as dbp,YY as yy,JSXL as jsxl,SPO2 as spo2,DXZ as dxz,DXY as dxy,DGZ as dgz,DGY as dgy,XT as xt,DGHL as dghl,QTDG as qtdg,RLMC as rlmc,RL as rl,CLMC as clmc,CL as cl,HLZD as hlzd,BQCS as bqcs,HSQM as hsqm,RQ as rq,JGID as jgid,STW as stw,PF as pf,XYFS as xyfs,PT as pt
    </sql>

    <insert id="insert">
        INSERT INTO NIS_WZHLD (
            JLXH ,
            ZYH ,
            MBLX ,
            YS ,
            TW ,
            MB ,
            HX ,
            SBP ,
            DBP ,
            YY ,
            JSXL ,
            SPO2 ,
            DXZ ,
            DXY ,
            DGZ ,
            DGY ,
            XT ,
            DGHL ,
            QTDG ,
            RLMC ,
            RL ,
            CLMC ,
            CL ,
            HLZD ,
            BQCS ,
            HSQM ,
            RQ ,
            JGID ,
            STW ,
			PF ,
			XYFS ,
			PT
        ) VALUES (
            #{jlxh} ,
            #{zyh} ,
            #{mblx} ,
            #{ys} ,
            #{tw} ,
            #{mb} ,
            #{hx} ,
            #{sbp} ,
            #{dbp} ,
            #{yy} ,
            #{jsxl} ,
            #{spo2} ,
            #{dxz} ,
            #{dxy} ,
            #{dgz} ,
            #{dgy} ,
            #{xt} ,
            #{dghl} ,
            #{qtdg} ,
            #{rlmc} ,
            #{rl} ,
            #{clmc} ,
            #{cl} ,
            #{hlzd} ,
            #{bqcs} ,
            #{hsqm} ,
            #{rq} ,
            #{jgid} ,
            #{stw} ,
			#{pf} ,
			#{xyfs} ,
			#{pt}
        )
    </insert>
    
    <update id="update" >
        UPDATE NIS_WZHLD SET
            ZYH = #{zyh} ,
            MBLX = #{mblx} ,
            YS = #{ys} ,
            TW = #{tw} ,
            MB = #{mb} ,
            HX = #{hx} ,
            SBP = #{sbp} ,
            DBP = #{dbp} ,
            YY = #{yy} ,
            JSXL = #{jsxl} ,
            SPO2 = #{spo2} ,
            DXZ = #{dxz} ,
            DXY = #{dxy} ,
            DGZ = #{dgz} ,
            DGY = #{dgy} ,
            XT = #{xt} ,
            DGHL = #{dghl} ,
            QTDG = #{qtdg} ,
            RlMC = #{rlmc} ,
            Rl = #{rl} ,
            CLMC = #{clmc} ,
            CL = #{cl} ,
            HLZD = #{hlzd} ,
            BQCS = #{bqcs} ,
            HSQM = #{hsqm} ,
            RQ = #{rq} ,
            JGID = #{jgid} ,
           	STW = #{stw} ,
			PF = #{pf} ,
		 	XYFS = #{xyfs} ,
			PT = #{pt}
        WHERE 
            JLXH = #{jlxh} 
    </update>

    <delete id="deleteById">
        DELETE FROM NIS_WZHLD WHERE
        JLXH = #{jlxh} 
    </delete>
    
    <delete id="removeByEntity">
        DELETE FROM NIS_WZHLD <include refid="where"/>  
    </delete>
    
    <select id="getById" resultType="NisWzhld">
        SELECT <include refid="columns" />
            FROM NIS_WZHLD 
            WHERE 
        JLXH = #{jlxh} 
    </select>
    
    <sql id="where">
        <where>                          
<!--                <if test="@sqlt.Ognl@isNotEmpty(jlxh)"> -->
<!--                     AND JLXH = #{jlxh} -->
<!--                </if> -->
                <if test="@sqlt.Ognl@isNotEmpty(zyh)">
                     AND ZYH = #{zyh}
                </if>
<!--                <if test="@sqlt.Ognl@isNotEmpty(mblx)"> -->
<!--                     AND MBLX = #{mblx} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(ys)"> -->
<!--                     AND YS = #{ys} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(tw)"> -->
<!--                     AND TW = #{tw} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(mb)"> -->
<!--                     AND MB = #{mb} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(hx)"> -->
<!--                     AND HX = #{hx} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(sbp)"> -->
<!--                     AND SBP = #{sbp} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dbp)"> -->
<!--                     AND DBP = #{dbp} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(yy)"> -->
<!--                     AND YY = #{yy} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(jsxl)"> -->
<!--                     AND JSXL = #{jsxl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(spo2)"> -->
<!--                     AND SPO2 = #{spo2} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dxz)"> -->
<!--                     AND DXZ = #{dxz} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dxy)"> -->
<!--                     AND DXY = #{dxy} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dgz)"> -->
<!--                     AND DGZ = #{dgz} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dgy)"> -->
<!--                     AND DGY = #{dgy} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(xt)"> -->
<!--                     AND XT = #{xt} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(dghl)"> -->
<!--                     AND DGHL = #{dghl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(qtdg)"> -->
<!--                     AND QTDG = #{qtdg} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(rlmc)"> -->
<!--                     AND RlMC = #{rlmc} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(rl)"> -->
<!--                     AND Rl = #{rl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(clmc)"> -->
<!--                     AND CLMC = #{clmc} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(cl)"> -->
<!--                     AND CL = #{cl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(hlzd)"> -->
<!--                     AND HLZD = #{hlzd} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(bqcs)"> -->
<!--                     AND BQCS = #{bqcs} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(hsqm)"> -->
<!--                     AND HSQM = #{hsqm} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(rq)"> -->
<!--                     AND RQ = #{rq} -->
<!--                </if> -->
                <if test="@sqlt.Ognl@isNotEmpty(jgid)"> 
                     AND JGID = #{jgid} 
                </if> 
<!--                <if test="@sqlt.Ognl@isNotEmpty(stw)"> -->
<!--                     AND STW = #{stw} -->
<!--                </if> -->     
<!--                <if test="@sqlt.Ognl@isNotEmpty(pf)"> -->
<!--                     AND PF = #{pf} -->
<!--                </if> -->   
<!--                <if test="@sqlt.Ognl@isNotEmpty(xyfs)"> -->
<!--                     AND XYFS = #{xyfs} -->
<!--                </if> -->         
<!--                <if test="@sqlt.Ognl@isNotEmpty(pt)"> -->
<!--                     AND PT = #{pt} -->
<!--                </if> --> 
        </where>
    </sql>
        
    <select id="findByEntityCount" resultType="long">
        SELECT count(*) FROM NIS_WZHLD 
        <include refid="where"/>    
    </select>
    
    <select id="findByEntity" resultType="NisWzhld">
        SELECT <include refid="columns" />
        FROM NIS_WZHLD 
        <include refid="where"/>
        
        <if test="@sqlt.Ognl@orderIsNotEmpty(sortColumns)">
            ORDER BY ${sortColumns}
        </if>
    </select>
    <!--     业务sql      -->
    
    <!-- 危重患者护理单查询树结构-->
    <select id="queryWzhldTree" resultType="com.buit.cis.nurse.response.NisHzmbResp">
        SELECT a.RQ as LABEL, a.MBLX as NAME
			FROM ( SELECT DATE_FORMAT( RQ, '%Y-%m' ) AS RQ, 
							ZYH as ZYH,
							MBLX as MBLX,
							JGID as JGID
				FROM NIS_WZHLD 
				GROUP BY 
					DATE_FORMAT(RQ, '%Y-%m'),
					ZYH,
					MBLX,
					JGID 
				) a, NIS_HZMB b WHERE
				a.ZYH = b.ZYH 
				AND a.MBLX = b.MBLX 
				AND a.JGID = b.JGID
				AND a.ZYH = #{zyh}
				AND a.JGID = #{jgid}
				order by a.RQ
    </select>
    
    <!-- 根据日期查询危重患者护理记录单 -->
    <select id="queryWzhldByDate" resultType="com.buit.cis.nurse.response.NisWzhldResp">
       SELECT JLXH as jlxh,ZYH as zyh,MBLX as mblx,YS as ys,TW as tw,MB as mb,HX as hx,SBP as sbp,DBP as dbp,YY as yy,JSXL as jsxl,SPO2 as spo2,DXZ as dxz,DXY as dxy,DGZ as dgz,DGY as dgy,XT as xt,DGHL as dghl,QTDG as qtdg,RLMC as rlmc,RL as rl,CLMC as clmc,CL as cl,HLZD as hlzd,BQCS as bqcs,HSQM as hsqm,date_format(RQ, '%Y-%m-%d %H:%i') as rq,JGID as jgid,STW as stw,PF as pf,XYFS as xyfs,PT as pt
        FROM NIS_WZHLD 
        WHERE ZYH = #{zyh}
		<if test="@sqlt.Ognl@isNotEmpty(queryDate)">
			  and DATE_FORMAT(RQ, '%m-%d') = #{queryDate}
        </if> 
        <if test="@sqlt.Ognl@isNotEmpty(yearMonth)">
			  and DATE_FORMAT(RQ, '%Y-%m') = #{yearMonth}
        </if> 
        and JGID = #{jgid}
        order by RQ
    </select>
    
    <!-- 根据日期查询危重患者护理记录单打印信息 -->
    <select id="queryPrintWzhldByDate" resultType="com.buit.cis.nurse.response.NisWzhldResp">
       SELECT JLXH as jlxh,ZYH as zyh,MBLX as mblx,YS as ys,TW as tw,MB as mb,HX as hx,SBP as sbp,DBP as dbp,YY as yy,JSXL as jsxl,SPO2 as spo2,DXZ as dxz,DXY as dxy,DGZ as dgz,DGY as dgy,XT as xt,case when find_in_set('其他',DGHL) then replace (DGHL, '其他', QTDG) else dghl end as dghl,QTDG as qtdg,RLMC as rlmc,RL as rl,CLMC as clmc,CL as cl,HLZD as hlzd,BQCS as bqcs,HSQM as hsqm,date_format(RQ, '%Y-%m-%d %H:%i') as rq,JGID as jgid,STW as stw,PF as pf,XYFS as xyfs,PT as pt
        FROM NIS_WZHLD 
        WHERE ZYH = #{zyh}
		<if test="@sqlt.Ognl@isNotEmpty(queryDate)">
			  and DATE_FORMAT(RQ, '%m-%d') = #{queryDate}
        </if> 
        <if test="@sqlt.Ognl@isNotEmpty(yearMonth)">
			  and DATE_FORMAT(RQ, '%Y-%m') = #{yearMonth}
        </if> 
        and JGID = #{jgid}
        order by RQ
    </select>
    
    <select id="queryWzhldTreeDetail" resultType="com.buit.cis.nurse.response.NisHzmbDetailResp">
         select concat(date_format(a.rq, '%m-%d'), '  ', b.mbmc ) as label, a.mblx as name
			from nis_wzhld a, nis_hzmb b 
			where a.zyh = b.zyh 
			and a.mblx = b.mblx 
			and a.jgid = b.jgid
			and a.zyh = #{zyh}
			and a.jgid = #{jgid}
			and date_format(a.rq, '%Y-%m') = #{yearMonth}
			group by concat(date_format(a.rq, '%m-%d'), ' ', b.mbmc ), a.mblx
			order by a.rq
    </select>
    
    <select id="getWzhldByJlxh" resultType="com.buit.cis.nurse.response.NisWzhldResp">
       SELECT JLXH as jlxh,ZYH as zyh,MBLX as mblx,YS as ys,TW as tw,MB as mb,HX as hx,SBP as sbp,DBP as dbp,YY as yy,JSXL as jsxl,SPO2 as spo2,DXZ as dxz,DXY as dxy,DGZ as dgz,DGY as dgy,XT as xt,case when find_in_set('其他',DGHL) then replace (DGHL, '其他', QTDG) else dghl end as dghl,QTDG as qtdg,RLMC as rlmc,RL as rl,CLMC as clmc,CL as cl,HLZD as hlzd,BQCS as bqcs,HSQM as hsqm,date_format(RQ, '%Y-%m-%d %H:%i') as rq,JGID as jgid,STW as stw,PF as pf,XYFS as xyfs,PT as pt
        FROM NIS_WZHLD 
        WHERE JLXH = #{jlxh}
    </select>
</mapper>

