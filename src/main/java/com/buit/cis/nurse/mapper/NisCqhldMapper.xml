<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 产前护理记录单 -->
<mapper namespace="com.buit.cis.nurse.dao.NisCqhldDao">

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
        JLXH as jlxh,ZYH as zyh,MBLX as mblx,TW as tw,MB as mb,HX as hx,XY as xy,SPO2 as spo2,YL as yl,TX as tx,TD as td,GS as gs,XFS as xfs,NL as nl,SZ as sz,LSXZ as lsxz,LSL as lsl,LXXZ as lxxz,LXL as lxl,DDPF as ddpf,PFPG as pfpg,JCHL as jchl,JKJY as jkjy,HSQM as hsqm,RQ as rq,BZXX as bzxx,JGID as jgid
    </sql>

    <insert id="insert">
        INSERT INTO NIS_CQHLD (
            JLXH ,
            ZYH ,
            MBLX ,
            TW ,
            MB ,
            HX ,
            XY ,
            SPO2 ,
            YL ,
            TX ,
            TD ,
            GS ,
            XFS ,
            NL ,
            SZ ,
            LSXZ ,
            LSL ,
            LXXZ ,
            LXL ,
            DDPF ,
            PFPG ,
            JCHL ,
            JKJY ,
            HSQM ,
            RQ ,
            BZXX ,
            JGID 
        ) VALUES (
            #{jlxh} ,
            #{zyh} ,
            #{mblx} ,
            #{tw} ,
            #{mb} ,
            #{hx} ,
            #{xy} ,
            #{spo2} ,
            #{yl} ,
            #{tx} ,
            #{td} ,
            #{gs} ,
            #{xfs} ,
            #{nl} ,
            #{sz} ,
            #{lsxz} ,
            #{lsl} ,
            #{lxxz} ,
            #{lxl} ,
            #{ddpf} ,
            #{pfpg} ,
            #{jchl} ,
            #{jkjy} ,
            #{hsqm} ,
            #{rq} ,
            #{bzxx} ,
            #{jgid} 
        )
    </insert>
    
    <update id="update" >
        UPDATE NIS_CQHLD SET
            ZYH = #{zyh} ,
            MBLX = #{mblx} ,
            TW = #{tw} ,
            MB = #{mb} ,
            HX = #{hx} ,
            XY = #{xy} ,
            SPO2 = #{spo2} ,
            YL = #{yl} ,
            TX = #{tx} ,
            TD = #{td} ,
            GS = #{gs} ,
            XFS = #{xfs} ,
            NL = #{nl} ,
            SZ = #{sz} ,
            LSXZ = #{lsxz} ,
            LSL = #{lsl} ,
            LXXZ = #{lxxz} ,
            LXL = #{lxl} ,
            DDPF = #{ddpf} ,
            PFPG = #{pfpg} ,
            JCHL = #{jchl} ,
            JKJY = #{jkjy} ,
            HSQM = #{hsqm} ,
            RQ = #{rq} ,
            BZXX = #{bzxx} ,
            JGID = #{jgid} 
        WHERE 
            JLXH = #{jlxh}            
    </update>

    <delete id="deleteById">
        DELETE FROM NIS_CQHLD WHERE
        JLXH = #{jlxh} 
    </delete>
    
    <delete id="removeByEntity">
        DELETE FROM NIS_CQHLD <include refid="where"/>  
    </delete>
    
    <select id="getById" resultType="NisCqhld">
        SELECT <include refid="columns" />
            FROM NIS_CQHLD 
            WHERE 
        JLXH = #{jlxh} 
    </select>
    
    <sql id="where">
        <where>                          
<!--                <if test="@sqlt.Ognl@isNotEmpty(jlxh)"> -->
<!--                     AND JLXH = #{jlxh} -->
<!--                </if> -->
                <if test="@sqlt.Ognl@isNotEmpty(zyh)">
                     AND ZYH = #{zyh}
                </if>
<!--                <if test="@sqlt.Ognl@isNotEmpty(mblx)"> -->
<!--                     AND MBLX = #{mblx} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(tw)"> -->
<!--                     AND TW = #{tw} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(mb)"> -->
<!--                     AND MB = #{mb} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(hx)"> -->
<!--                     AND HX = #{hx} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(xy)"> -->
<!--                     AND XY = #{xy} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(spo2)"> -->
<!--                     AND SPO2 = #{spo2} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(yl)"> -->
<!--                     AND YL = #{yl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(tx)"> -->
<!--                     AND TX = #{tx} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(td)"> -->
<!--                     AND TD = #{td} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(gs)"> -->
<!--                     AND GS = #{gs} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(xfs)"> -->
<!--                     AND XFS = #{xfs} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(nl)"> -->
<!--                     AND NL = #{nl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(sz)"> -->
<!--                     AND SZ = #{sz} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(lsxz)"> -->
<!--                     AND LSXZ = #{lsxz} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(lsl)"> -->
<!--                     AND LSL = #{lsl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(lxxz)"> -->
<!--                     AND LXXZ = #{lxxz} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(lxl)"> -->
<!--                     AND LXL = #{lxl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(ddpf)"> -->
<!--                     AND DDPF = #{ddpf} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(pfpg)"> -->
<!--                     AND PFPG = #{pfpg} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(jchl)"> -->
<!--                     AND JCHL = #{jchl} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(jkjy)"> -->
<!--                     AND JKJY = #{jkjy} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(hsqm)"> -->
<!--                     AND HSQM = #{hsqm} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(rq)"> -->
<!--                     AND RQ = #{rq} -->
<!--                </if> -->
<!--                <if test="@sqlt.Ognl@isNotEmpty(bzxx)"> -->
<!--                     AND BZXX = #{bzxx} -->
<!--                </if> -->
                <if test="@sqlt.Ognl@isNotEmpty(jgid)">
                     AND JGID = #{jgid} 
                </if> 
        </where>
    </sql>
        
    <select id="findByEntityCount" resultType="long">
        SELECT count(*) FROM NIS_CQHLD 
        <include refid="where"/>    
    </select>
    
    <select id="findByEntity" resultType="NisCqhld">
        SELECT <include refid="columns" />
        FROM NIS_CQHLD 
        <include refid="where"/>
        
        <if test="@sqlt.Ognl@orderIsNotEmpty(sortColumns)">
            ORDER BY ${sortColumns}
        </if>
    </select>
    <!--     业务sql      -->
    
    <!-- 产前护理记录单查询树结构-->
    <select id="queryCqhldTree" resultType="com.buit.cis.nurse.response.NisHzmbResp">
        SELECT a.RQ as LABEL, a.MBLX as NAME
			FROM ( SELECT DATE_FORMAT( RQ, '%Y-%m' ) AS RQ, 
							ZYH as ZYH,
							MBLX as MBLX,
							JGID as JGID
				FROM NIS_CQHLD 
				GROUP BY 
					DATE_FORMAT(RQ, '%Y-%m'),
					ZYH,
					MBLX,
					JGID 
				) a, NIS_HZMB b WHERE
				a.ZYH = b.ZYH 
				AND a.MBLX = b.MBLX 
				AND a.JGID = b.JGID
				AND a.ZYH = #{zyh}
				AND a.JGID = #{jgid}
				order by a.RQ
    </select>
    
    <!-- 根据日期查询产前护理记录单 -->
    <select id="queryCqhldByDate" resultType="NisCqhld">
       SELECT <include refid="columns" />
        FROM NIS_CQHLD 
        WHERE ZYH = #{zyh}
		<if test="@sqlt.Ognl@isNotEmpty(queryDate)">
			  and DATE_FORMAT(RQ, '%m-%d') = #{queryDate}
        </if>
        <if test="@sqlt.Ognl@isNotEmpty(yearMonth)">
			  and DATE_FORMAT(RQ, '%Y-%m') = #{yearMonth}
        </if>  
        and JGID = #{jgid}
        order by RQ
    </select>
    
    <select id="queryCqhldTreeDetail" resultType="com.buit.cis.nurse.response.NisHzmbDetailResp">
         select concat(date_format(a.rq, '%m-%d'), '  ', b.mbmc ) as label, a.mblx as name
			from nis_cqhld a, nis_hzmb b 
			where a.zyh = b.zyh 
			and a.mblx = b.mblx 
			and a.jgid = b.jgid
			and a.zyh = #{zyh}
			and a.jgid = #{jgid}
			and date_format(a.rq, '%Y-%m') = #{yearMonth}
			group by concat(date_format(a.rq, '%m-%d'), ' ', b.mbmc ), a.mblx
			order by a.rq
    </select>
</mapper>

